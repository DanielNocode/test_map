<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Карта Идеальных Отношений — Схема квиза v2.0</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0d0d1a;
  --bg-board: #111122;
  --card-bg: #1a1a2e;
  --card-bg2: #1e1e36;
  --border: #2a2a4a;
  --text: #d0d0e8;
  --text-dim: #7777aa;
  --text-bright: #ffffff;
  --pink: #ff6b9d;
  --pink-bg: rgba(255,107,157,0.10);
  --blue: #6b9dff;
  --blue-bg: rgba(107,157,255,0.10);
  --purple: #a06bff;
  --purple-bg: rgba(160,107,255,0.10);
  --orange: #ffaa6b;
  --orange-bg: rgba(255,170,107,0.10);
  --green: #6bffb8;
  --green-bg: rgba(107,255,184,0.10);
  --yellow: #ffd76b;
  --yellow-bg: rgba(255,215,107,0.10);
}

body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  overflow: hidden;
  height: 100vh;
  user-select: text;
}

/* ===== TOOLBAR ===== */
.toolbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 44px;
  background: rgba(13,13,26,0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 16px;
  z-index: 1000;
  gap: 12px;
}
.toolbar-title { font-size: 14px; font-weight: 700; color: var(--text-bright); white-space: nowrap; }
.toolbar-sub { font-size: 11px; color: var(--text-dim); }
.toolbar-sep { width: 1px; height: 20px; background: var(--border); }
.toolbar-nav { display: flex; gap: 3px; flex-wrap: nowrap; overflow-x: auto; }
.chip { padding: 3px 10px; border-radius: 10px; font-size: 11px; cursor: pointer; border: 1px solid transparent; color: var(--text-dim); transition: 0.2s; white-space: nowrap; }
.chip:hover { color: var(--text-bright); background: rgba(255,255,255,0.06); }
.chip-pink { border-color: rgba(255,107,157,0.3); color: var(--pink); }
.chip-blue { border-color: rgba(107,157,255,0.3); color: var(--blue); }
.chip-purple { border-color: rgba(160,107,255,0.3); color: var(--purple); }
.chip-orange { border-color: rgba(255,170,107,0.3); color: var(--orange); }
.chip-green { border-color: rgba(107,255,184,0.3); color: var(--green); }
.zoom-controls { display: flex; align-items: center; gap: 5px; margin-left: auto; }
.zoom-controls span { font-size: 11px; color: var(--text-dim); min-width: 36px; text-align: center; }
.tbtn { padding: 3px 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 5px; color: var(--text); font-size: 12px; cursor: pointer; }
.tbtn:hover { background: rgba(255,255,255,0.1); }

/* ===== CANVAS ===== */
.canvas-wrap {
  position: fixed;
  top: 44px; left: 0; right: 0; bottom: 0;
  overflow: hidden;
  cursor: grab;
  background: var(--bg-board);
}
.canvas-wrap.panning { cursor: grabbing; }
.canvas-grid {
  position: absolute; inset: 0;
  background-image: radial-gradient(circle, rgba(255,255,255,0.025) 1px, transparent 1px);
  background-size: 28px 28px;
  pointer-events: none;
}
.canvas {
  position: absolute;
  transform-origin: 0 0;
  will-change: transform;
}

/* ===== SVG ===== */
.arrows-svg {
  position: absolute; top: 0; left: 0;
  pointer-events: none; overflow: visible;
}

/* ===== QUESTION CARD ===== */
.qcard {
  position: absolute;
  width: 340px;
  background: var(--card-bg);
  border: 1.5px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 4px 24px rgba(0,0,0,0.5);
  transition: box-shadow 0.2s, border-color 0.15s;
  cursor: grab;
}
.qcard:hover { box-shadow: 0 8px 32px rgba(0,0,0,0.7); }
.qcard.dragging, .decision.dragging, .placeholder-card.dragging {
  cursor: grabbing !important;
  z-index: 100 !important;
  box-shadow: 0 0 40px rgba(160,107,255,0.4), 0 12px 40px rgba(0,0,0,0.6) !important;
  border-color: var(--purple) !important;
  opacity: 0.92;
}

.qcard-head {
  padding: 12px 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid var(--border);
}
.qcard-num {
  padding: 3px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 800;
  flex-shrink: 0;
}
.qcard-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-bright);
  flex: 1;
}
.qcard-var {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 4px;
  background: var(--green-bg);
  color: var(--green);
}

.qcard-msg {
  padding: 10px 16px;
  font-size: 12px;
  color: var(--text-dim);
  border-bottom: 1px solid rgba(255,255,255,0.03);
  white-space: pre-line;
  line-height: 1.6;
}

.qcard-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 11px;
}
.qcard-table th {
  text-align: left;
  padding: 6px 12px;
  background: rgba(255,255,255,0.02);
  color: var(--text-dim);
  font-weight: 600;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.qcard-table td {
  padding: 5px 12px;
  border-top: 1px solid rgba(255,255,255,0.025);
}
.qcard-table tr:hover td { background: rgba(255,255,255,0.015); }
.v { color: var(--green); font-family: monospace; font-size: 11px; }
.p { color: var(--yellow); font-weight: 700; }
.b { display: inline-block; padding: 1px 8px; background: var(--purple-bg); border-radius: 4px; color: var(--purple); font-weight: 700; font-size: 11px; }

.qcard-next {
  padding: 8px 16px;
  font-size: 11px;
  border-top: 1px solid rgba(255,255,255,0.03);
  color: var(--text-dim);
}
.qcard-next strong { color: var(--purple); }
.next-pink { color: var(--pink); }
.next-blue { color: var(--blue); }

/* Card border colors */
.qcard-purple { border-color: rgba(160,107,255,0.4); }
.qcard-purple .qcard-head { background: var(--purple-bg); }
.qcard-purple .qcard-num { background: var(--purple-bg); color: var(--purple); }

.qcard-pink { border-color: rgba(255,107,157,0.4); }
.qcard-pink .qcard-head { background: var(--pink-bg); }
.qcard-pink .qcard-num { background: var(--pink-bg); color: var(--pink); }

.qcard-blue { border-color: rgba(107,157,255,0.4); }
.qcard-blue .qcard-head { background: var(--blue-bg); }
.qcard-blue .qcard-num { background: var(--blue-bg); color: var(--blue); }

.qcard-orange { border-color: rgba(255,170,107,0.4); }
.qcard-orange .qcard-head { background: var(--orange-bg); }
.qcard-orange .qcard-num { background: var(--orange-bg); color: var(--orange); }

.qcard-green { border-color: rgba(107,255,184,0.4); }
.qcard-green .qcard-head { background: var(--green-bg); }
.qcard-green .qcard-num { background: var(--green-bg); color: var(--green); }

/* ===== GROUP LABEL ===== */
.group-label {
  position: absolute;
  font-size: 15px;
  font-weight: 800;
  letter-spacing: 1.5px;
  opacity: 0.35;
  pointer-events: none;
  text-transform: uppercase;
  padding: 4px 12px;
  border-radius: 6px;
  border-left: 3px solid currentColor;
}

/* ===== BRANCH LABEL ===== */
.branch-tag {
  position: absolute;
  padding: 4px 14px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
}

/* ===== DECISION NODE ===== */
.decision {
  position: absolute;
  background: var(--card-bg);
  border: 2px dashed var(--purple);
  border-radius: 14px;
  padding: 14px 24px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  cursor: grab;
}
.placeholder-card { cursor: grab; }
.decision-label { font-size: 14px; font-weight: 700; color: var(--text-bright); }
.decision-sub { font-size: 11px; color: var(--text-dim); margin-top: 2px; }

/* ===== LEGEND ===== */
.legend {
  position: fixed; bottom: 12px; left: 12px;
  background: rgba(13,13,26,0.92); backdrop-filter: blur(8px);
  border: 1px solid var(--border); border-radius: 10px;
  padding: 10px 14px; z-index: 500; font-size: 11px;
}
.legend-row { display: flex; align-items: center; gap: 7px; margin-bottom: 3px; }
.legend-row:last-child { margin-bottom: 0; }
.legend-dot { width: 10px; height: 10px; border-radius: 3px; }

/* ===== MINIMAP ===== */
.minimap {
  position: fixed; bottom: 12px; right: 12px;
  width: 180px; height: 120px;
  background: rgba(13,13,26,0.92); backdrop-filter: blur(8px);
  border: 1px solid var(--border); border-radius: 10px;
  overflow: hidden; z-index: 500;
}
.minimap canvas { width: 100%; height: 100%; }
.minimap-vp { position: absolute; border: 1.5px solid var(--purple); background: rgba(160,107,255,0.06); border-radius: 2px; pointer-events: none; }

/* ===== PLACEHOLDER ===== */
.placeholder-card {
  position: absolute;
  width: 340px;
  background: var(--card-bg);
  border: 1.5px dashed var(--border);
  border-radius: 14px;
  padding: 30px 20px;
  text-align: center;
  color: var(--text-dim);
  font-size: 13px;
  font-style: italic;
  opacity: 0.6;
}
</style>
</head>
<body>

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="toolbar-title">Карта Идеальных Отношений</div>
  <div class="toolbar-sub">v2.0</div>
  <div class="toolbar-sep"></div>
  <div class="toolbar-nav">
    <div class="chip chip-purple" onclick="jumpTo(880,60)">Блок 1</div>
    <div class="chip chip-pink" onclick="jumpTo(270,1180)">2А</div>
    <div class="chip chip-blue" onclick="jumpTo(1570,1180)">2Б</div>
    <div class="chip chip-orange" onclick="jumpTo(860,2600)">Блок 3</div>
    <div class="chip chip-pink" onclick="jumpTo(270,3700)">4А</div>
    <div class="chip chip-blue" onclick="jumpTo(1570,3700)">4Б</div>
    <div class="chip chip-pink" onclick="jumpTo(400,4700)">Блок 5</div>
    <div class="chip chip-green" onclick="jumpTo(800,5700)">Результат</div>
  </div>
  <div class="zoom-controls">
    <button class="tbtn" onclick="zoomBy(-0.1)">-</button>
    <span id="zoomLvl">45%</span>
    <button class="tbtn" onclick="zoomBy(0.1)">+</button>
    <button class="tbtn" onclick="resetView()">Fit</button>
    <span style="width:1px;height:20px;background:var(--border);margin:0 4px"></span>
    <button class="tbtn" onclick="exportLayout()" title="Скачать координаты карточек">Export</button>
    <button class="tbtn" onclick="resetLayout()" title="Сбросить расположение">Reset</button>
  </div>
</div>

<!-- CANVAS -->
<div class="canvas-wrap" id="wrap">
  <div class="canvas-grid"></div>
  <div class="canvas" id="canvas">

    <!-- SVG arrows -->
    <svg class="arrows-svg" id="svg" width="2200" height="6500">
      <defs>
        <marker id="ap" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#a06bff"/></marker>
        <marker id="ak" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#ff6b9d"/></marker>
        <marker id="ab" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#6b9dff"/></marker>
        <marker id="ao" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#ffaa6b"/></marker>
        <marker id="ag" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#6bffb8"/></marker>
      </defs>
    </svg>

    <!-- ========== BLOCK 1: BASE STATUS ========== -->
    <div class="group-label" style="left:880px; top:20px; color:var(--purple);">Блок 1: Базовый Статус</div>

    <!-- Q 1.1 -->
    <div class="qcard qcard-purple" id="q11" style="left:880px; top:60px;">
      <div class="qcard-head">
        <span class="qcard-num">1.1</span>
        <span class="qcard-title">Сейчас ты...</span>
        <span class="qcard-var">{status}</span>
      </div>
      <div class="qcard-msg">Карта Идеальных Отношений
Начнём с главного. Сейчас ты...</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th>Далее</th></tr>
        <tr><td><span class="b">1</span> Свободна</td><td class="v">free</td><td>-> 1.1б</td></tr>
        <tr><td><span class="b">2</span> В отношениях</td><td class="v">together</td><td>-> 1.2</td></tr>
        <tr><td><span class="b">3</span> Замужем</td><td class="v">married</td><td>-> 1.2</td></tr>
      </table>
    </div>

    <!-- branch labels -->
    <div class="branch-tag" style="left:620px; top:295px; background:var(--blue-bg); color:var(--blue);">status = free</div>
    <div class="branch-tag" style="left:1350px; top:295px; background:var(--pink-bg); color:var(--pink);">status != free</div>

    <!-- Q 1.1б -->
    <div class="qcard qcard-purple" id="q11b" style="left:440px; top:340px;">
      <div class="qcard-head">
        <span class="qcard-num">1.1б</span>
        <span class="qcard-title">Почему сейчас одна?</span>
        <span class="qcard-var">{why_single}</span>
      </div>
      <div class="qcard-msg">Только если status = free
Авто: {years} = none</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Не отошла от прошлых</td><td class="v">past_hurt</td></tr>
        <tr><td><span class="b">2</span> Не могу найти нормальных</td><td class="v">no_good_men</td></tr>
        <tr><td><span class="b">3</span> Нет времени</td><td class="v">no_time</td></tr>
        <tr><td><span class="b">4</span> Сама так решила</td><td class="v">by_choice</td></tr>
        <tr><td><span class="b">5</span> Так сложилось</td><td class="v">just_happened</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Вопрос 1.3</strong></div>
    </div>

    <!-- Q 1.2 -->
    <div class="qcard qcard-purple" id="q12" style="left:1300px; top:340px;">
      <div class="qcard-head">
        <span class="qcard-num">1.2</span>
        <span class="qcard-title">Сколько вы вместе?</span>
        <span class="qcard-var">{years}</span>
      </div>
      <div class="qcard-msg">Только если status != free</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> До 1 года</td><td class="v">under1</td></tr>
        <tr><td><span class="b">2</span> 1-3 года</td><td class="v">1to3</td></tr>
        <tr><td><span class="b">3</span> 3-7 лет</td><td class="v">3to7</td></tr>
        <tr><td><span class="b">4</span> 7-15 лет</td><td class="v">7to15</td></tr>
        <tr><td><span class="b">5</span> Больше 15 лет</td><td class="v">over15</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Вопрос 1.3</strong></div>
    </div>

    <!-- Q 1.3 -->
    <div class="qcard qcard-purple" id="q13" style="left:880px; top:760px;">
      <div class="qcard-head">
        <span class="qcard-num">1.3</span>
        <span class="qcard-title">Дети?</span>
        <span class="qcard-var">{kids}</span>
      </div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Нет детей</td><td class="v">no</td></tr>
        <tr><td><span class="b">2</span> Маленькие (до 7)</td><td class="v">small</td></tr>
        <tr><td><span class="b">3</span> Школьники/подростки</td><td class="v">teen</td></tr>
        <tr><td><span class="b">4</span> Уже взрослые</td><td class="v">adult</td></tr>
      </table>
      <div class="qcard-next">
        <span class="next-pink">status != free -> Блок 2А</span> &middot;
        <span class="next-blue">status = free -> Блок 2Б</span>
      </div>
    </div>

    <!-- ========== DECISION ========== -->
    <div class="decision" id="dec1" style="left:920px; top:1040px;">
      <div class="decision-label">Развилка по {status}</div>
      <div class="decision-sub">free -> 2Б &middot; together/married -> 2А</div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 2A: IN COUPLE (3 questions) =============== -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:100px; top:1100px; color:var(--pink);">Блок 2А: В Паре (status != free)</div>

    <!-- Q 2A.1 -->
    <div class="qcard qcard-pink" id="q2a1" style="left:100px; top:1180px;">
      <div class="qcard-head">
        <span class="qcard-num">2А.1</span>
        <span class="qcard-title">В близости комфортнее...</span>
        <span class="qcard-var">{her_role}</span>
      </div>
      <div class="qcard-msg">В близости тебе комфортнее, когда...</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Он ведёт, я отдаюсь</td><td class="v">receiver</td></tr>
        <tr><td><span class="b">2</span> Я веду, он в моих руках</td><td class="v">giver</td></tr>
        <tr><td><span class="b">3</span> Мы на равных</td><td class="v">equal</td></tr>
        <tr><td><span class="b">4</span> Зависит от настроения</td><td class="v">flexible</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2А.2</strong></div>
    </div>

    <!-- Q 2A.2 -->
    <div class="qcard qcard-pink" id="q2a2" style="left:100px; top:1530px;">
      <div class="qcard-head">
        <span class="qcard-num">2А.2</span>
        <span class="qcard-title">Прокачать одно — что?</span>
        <span class="qcard-var">{her_goal}</span>
      </div>
      <div class="qcard-msg">Если бы можно было прокачать одно — что бы выбрала?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Чувствовать себя желанной</td><td class="v">confidence</td></tr>
        <tr><td><span class="b">2</span> Доставлять ему незабываемое</td><td class="v">skills</td></tr>
        <tr><td><span class="b">3</span> Получать больше удовольствия</td><td class="v">pleasure</td></tr>
        <tr><td><span class="b">4</span> Добавить экспериментов</td><td class="v">experiments</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2А.3</strong></div>
    </div>

    <!-- Q 2A.3 -->
    <div class="qcard qcard-pink" id="q2a3" style="left:100px; top:1880px;">
      <div class="qcard-head">
        <span class="qcard-num">2А.3</span>
        <span class="qcard-title">Что уже есть?</span>
        <span class="qcard-var">{her_experience}</span>
      </div>
      <div class="qcard-msg">Что из этого уже есть в твоей жизни? (выбери главное)</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Оральные ласки — моя сила</td><td class="v">oral</td></tr>
        <tr><td><span class="b">2</span> Экспериментирую с позами</td><td class="v">poses</td></tr>
        <tr><td><span class="b">3</span> Использую игрушки</td><td class="v">toys</td></tr>
        <tr><td><span class="b">4</span> Пробовала ролевые</td><td class="v">roleplay</td></tr>
        <tr><td><span class="b">5</span> Базовый опыт, хочу большего</td><td class="v">basic</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Блок 3</strong> (вопрос 3.1)</div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 2B: SINGLE (6 questions) ================== -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:1400px; top:1100px; color:var(--blue);">Блок 2Б: Свободна (status = free)</div>

    <!-- Q 2Б.1 -->
    <div class="qcard qcard-blue" id="q2b1" style="left:1400px; top:1180px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.1</span>
        <span class="qcard-title">Когда последний секс?</span>
        <span class="qcard-var">{last_sex}</span>
      </div>
      <div class="qcard-msg">Когда у тебя был секс последний раз?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Баллы</th></tr>
        <tr><td><span class="b">1</span> На этой неделе</td><td class="v">this_week</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> В этом месяце</td><td class="v">this_month</td><td class="p">4</td></tr>
        <tr><td><span class="b">3</span> Несколько месяцев назад</td><td class="v">few_months</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Полгода-год назад</td><td class="v">half_year</td><td class="p">2</td></tr>
        <tr><td><span class="b">5</span> Больше года</td><td class="v">over_year</td><td class="p">1</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2Б.2</strong></div>
    </div>

    <!-- Q 2Б.2 -->
    <div class="qcard qcard-blue" id="q2b2" style="left:1400px; top:1530px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.2</span>
        <span class="qcard-title">Тебя зовут на свидания?</span>
        <span class="qcard-var">{dates_invites}</span>
      </div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Баллы</th></tr>
        <tr><td><span class="b">1</span> Регулярно, отбоя нет</td><td class="v">often</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> Иногда приглашают</td><td class="v">sometimes</td><td class="p">4</td></tr>
        <tr><td><span class="b">3</span> Редко, но бывает</td><td class="v">rare</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Почти никогда</td><td class="v">almost_never</td><td class="p">2</td></tr>
        <tr><td><span class="b">5</span> Сама не даю повода</td><td class="v">no_signals</td><td class="p">1</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2Б.3</strong></div>
    </div>

    <!-- Q 2Б.3 -->
    <div class="qcard qcard-blue" id="q2b3" style="left:1400px; top:1880px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.3</span>
        <span class="qcard-title">Приложения для знакомств?</span>
        <span class="qcard-var">{dating_apps}</span>
      </div>
      <div class="qcard-msg">Пользуешься приложениями для знакомств?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Баллы</th></tr>
        <tr><td><span class="b">1</span> Да, активно свайпаю</td><td class="v">active</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> Есть профиль, иногда</td><td class="v">passive</td><td class="p">3</td></tr>
        <tr><td><span class="b">3</span> Пробовала, удалила</td><td class="v">tried_quit</td><td class="p">2</td></tr>
        <tr><td><span class="b">4</span> Нет, принципиально</td><td class="v">no_principle</td><td class="p">1</td></tr>
        <tr><td><span class="b">5</span> Думаю попробовать</td><td class="v">thinking</td><td class="p">2</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2Б.4</strong></div>
    </div>

    <!-- Q 2Б.4 -->
    <div class="qcard qcard-blue" id="q2b4" style="left:1820px; top:1180px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.4</span>
        <span class="qcard-title">Умеешь флиртовать?</span>
        <span class="qcard-var">{flirt_skill}</span>
      </div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Баллы</th></tr>
        <tr><td><span class="b">1</span> Мой конёк, мужчины тают</td><td class="v">expert</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> Умею, когда нравится</td><td class="v">good</td><td class="p">4</td></tr>
        <tr><td><span class="b">3</span> Пытаюсь, не уверена</td><td class="v">trying</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Стесняюсь</td><td class="v">shy</td><td class="p">2</td></tr>
        <tr><td><span class="b">5</span> Жду когда сами подойдут</td><td class="v">passive</td><td class="p">1</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2Б.5</strong></div>
    </div>

    <!-- Q 2Б.5 -->
    <div class="qcard qcard-blue" id="q2b5" style="left:1820px; top:1530px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.5</span>
        <span class="qcard-title">На первом свидании?</span>
        <span class="qcard-var">{first_date_feel}</span>
      </div>
      <div class="qcard-msg">Как ты себя ощущаешь на первом свидании?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Баллы</th></tr>
        <tr><td><span class="b">1</span> Как королева</td><td class="v">confident</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> Нормально, чуть волнуюсь</td><td class="v">normal</td><td class="p">4</td></tr>
        <tr><td><span class="b">3</span> Напрягаюсь</td><td class="v">tense</td><td class="p">2</td></tr>
        <tr><td><span class="b">4</span> Сильно нервничаю</td><td class="v">anxious</td><td class="p">1</td></tr>
        <tr><td><span class="b">5</span> Давно не была, не помню</td><td class="v">forgot</td><td class="p">2</td></tr>
      </table>
      <div class="qcard-next">-> <strong>2Б.6</strong></div>
    </div>

    <!-- Q 2Б.6 -->
    <div class="qcard qcard-blue" id="q2b6" style="left:1820px; top:1880px;">
      <div class="qcard-head">
        <span class="qcard-num">2Б.6</span>
        <span class="qcard-title">Прокачать одно — что?</span>
        <span class="qcard-var">{her_goal_single}</span>
      </div>
      <div class="qcard-msg">Если бы можно было прокачать одно — что бы выбрала?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Привлекать достойных мужчин</td><td class="v">attract</td></tr>
        <tr><td><span class="b">2</span> Увереннее в сексуальности</td><td class="v">confidence</td></tr>
        <tr><td><span class="b">3</span> Понять какой мужчина нужен</td><td class="v">understand</td></tr>
        <tr><td><span class="b">4</span> Искусство соблазнения</td><td class="v">seduce</td></tr>
        <tr><td><span class="b">5</span> Строить здоровые отношения</td><td class="v">healthy</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Блок 3</strong> (вопрос 3.1)</div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 3: OPENNESS (9 questions, 2 rows) ========= -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:100px; top:2360px; color:var(--orange);">Блок 3: Раскрепощённость (для всех) — 9 вопросов с баллами</div>

    <!-- Row 1: 3.1 - 3.5 -->
    <!-- Q 3.1 -->
    <div class="qcard qcard-orange" id="q31" style="left:100px; top:2420px;">
      <div class="qcard-head">
        <span class="qcard-num">3.1</span>
        <span class="qcard-title">Как одеваешься?</span>
        <span class="qcard-var">{style}</span>
      </div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Удобно, практично</td><td class="v">comfy</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Женственно</td><td class="v">feminine</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Подчеркнуть фигуру</td><td class="v">sexy</td><td class="p">4</td></tr>
        <tr><td><span class="b">4</span> Чтоб оборачивались</td><td class="v">hot</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.2 -->
    <div class="qcard qcard-orange" id="q32" style="left:480px; top:2420px;">
      <div class="qcard-head">
        <span class="qcard-num">3.2</span>
        <span class="qcard-title">Оральные ласки?</span>
        <span class="qcard-var">{oral_attitude}</span>
      </div>
      <div class="qcard-msg">Как относишься к оральным ласкам (делать ему)?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Не люблю</td><td class="v">dislike</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Нормально</td><td class="v">neutral</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Нравится</td><td class="v">like</td><td class="p">4</td></tr>
        <tr><td><span class="b">4</span> Обожаю</td><td class="v">love</td><td class="p">5</td></tr>
        <tr><td><span class="b">5</span> Не практикую</td><td class="v">no</td><td class="p">0</td></tr>
      </table>
    </div>

    <!-- Q 3.3 -->
    <div class="qcard qcard-orange" id="q33" style="left:860px; top:2420px;">
      <div class="qcard-head">
        <span class="qcard-num">3.3</span>
        <span class="qcard-title">Комфорт обнажённой?</span>
        <span class="qcard-var">{body_comfort}</span>
      </div>
      <div class="qcard-msg">Насколько комфортно чувствуешь себя обнажённой?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Только в темноте</td><td class="v">dark_only</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Неловко</td><td class="v">awkward</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Спокойно наедине</td><td class="v">private_ok</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Комфортно всегда</td><td class="v">comfortable</td><td class="p">4</td></tr>
        <tr><td><span class="b">5</span> Обожаю своё тело</td><td class="v">confident</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.4 -->
    <div class="qcard qcard-orange" id="q34" style="left:1240px; top:2420px;">
      <div class="qcard-head">
        <span class="qcard-num">3.4</span>
        <span class="qcard-title">Секс-игрушки?</span>
        <span class="qcard-var">{toys_exp}</span>
      </div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Никогда не пробовала</td><td class="v">never</td><td class="p">0</td></tr>
        <tr><td><span class="b">2</span> Пробовала, не зашло</td><td class="v">tried</td><td class="p">1</td></tr>
        <tr><td><span class="b">3</span> Есть, иногда сама</td><td class="v">solo</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Регулярно</td><td class="v">regular</td><td class="p">4</td></tr>
        <tr><td><span class="b">5</span> С партнёром вместе</td><td class="v">couple</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.5 -->
    <div class="qcard qcard-orange" id="q35" style="left:1620px; top:2420px;">
      <div class="qcard-head">
        <span class="qcard-num">3.5</span>
        <span class="qcard-title">Озвучиваешь желания?</span>
        <span class="qcard-var">{communicate_desires}</span>
      </div>
      <div class="qcard-msg">Как легко озвучивать желания в постели?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Не озвучиваю</td><td class="v">silent</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Намёками</td><td class="v">hints</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Стараюсь прямо</td><td class="v">try_direct</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Всегда чётко</td><td class="v">direct</td><td class="p">4</td></tr>
        <tr><td><span class="b">5</span> Командую</td><td class="v">command</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Row 2: 3.6 - 3.9 -->
    <!-- Q 3.6 -->
    <div class="qcard qcard-orange" id="q36" style="left:100px; top:2760px;">
      <div class="qcard-head">
        <span class="qcard-num">3.6</span>
        <span class="qcard-title">Эксперименты?</span>
        <span class="qcard-var">{experiments}</span>
      </div>
      <div class="qcard-msg">Насколько открыта к экспериментам?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Предпочитаю классику</td><td class="v">classic</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Если он очень хочет</td><td class="v">if_he_wants</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Открыта, если комфортно</td><td class="v">open</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Люблю пробовать новое</td><td class="v">like</td><td class="p">4</td></tr>
        <tr><td><span class="b">5</span> Чем необычнее тем лучше</td><td class="v">love</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.7 -->
    <div class="qcard qcard-orange" id="q37" style="left:480px; top:2760px;">
      <div class="qcard-head">
        <span class="qcard-num">3.7</span>
        <span class="qcard-title">Инициатива близости?</span>
        <span class="qcard-var">{her_initiative}</span>
      </div>
      <div class="qcard-msg">Как часто сама инициируешь близость?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Почти никогда</td><td class="v">never</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Редко, раз в месяц</td><td class="v">rare</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Иногда, 50/50</td><td class="v">sometimes</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Часто, люблю инициативу</td><td class="v">often</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.8 -->
    <div class="qcard qcard-orange" id="q38" style="left:860px; top:2760px;">
      <div class="qcard-head">
        <span class="qcard-num">3.8</span>
        <span class="qcard-title">Звуки во время?</span>
        <span class="qcard-var">{vocal}</span>
      </div>
      <div class="qcard-msg">Какие звуки издаёшь во время секса?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Молчу, стесняюсь</td><td class="v">silent</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> Тихонько стону</td><td class="v">quiet</td><td class="p">2</td></tr>
        <tr><td><span class="b">3</span> Стону в голос</td><td class="v">loud</td><td class="p">4</td></tr>
        <tr><td><span class="b">4</span> Стону + dirty talk</td><td class="v">dirty_talk</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- Q 3.9 -->
    <div class="qcard qcard-orange" id="q39" style="left:1240px; top:2760px;">
      <div class="qcard-head">
        <span class="qcard-num">3.9</span>
        <span class="qcard-title">Где был секс?</span>
        <span class="qcard-var">{location}</span>
      </div>
      <div class="qcard-msg">Где был секс за последний год?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Только в спальне</td><td class="v">bed_only</td><td class="p">1</td></tr>
        <tr><td><span class="b">2</span> В разных местах дома</td><td class="v">home</td><td class="p">3</td></tr>
        <tr><td><span class="b">3</span> Машина / природа</td><td class="v">public</td><td class="p">5</td></tr>
        <tr><td><span class="b">4</span> Где угодно</td><td class="v">anywhere</td><td class="p">5</td></tr>
      </table>
    </div>

    <!-- ========== SCORING ========== -->
    <div class="placeholder-card qcard-orange" id="scoring" style="left:700px; top:3100px; width:700px;">
      Этап 5 — Шкала баллов 0-44<br>
      {total_score} -> {level}: sleeping / awakening / free / fire / goddess
    </div>

    <!-- ========== DECISION 2 ========== -->
    <div class="decision" id="dec2" style="left:920px; top:3280px;">
      <div class="decision-label">Развилка 2 по {status}</div>
      <div class="decision-sub">free -> 4Б -> Результат &middot; !=free -> 4А -> 5 -> Результат</div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 4A: ABOUT HIM (3 questions) =============== -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:100px; top:3380px; color:var(--pink);">Блок 4А: Про Него (status != free)</div>

    <!-- Q 4A.1 -->
    <div class="qcard qcard-pink" id="q4a1" style="left:100px; top:3440px;">
      <div class="qcard-head">
        <span class="qcard-num">4А.1</span>
        <span class="qcard-title">Как он хочет тебя?</span>
        <span class="qcard-var">{he_desire}</span>
      </div>
      <div class="qcard-msg">Как он обычно показывает, что хочет тебя?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Прямо — берёт и показывает</td><td class="v">direct</td></tr>
        <tr><td><span class="b">2</span> Намёками</td><td class="v">hints</td></tr>
        <tr><td><span class="b">3</span> Редко проявляет инициативу</td><td class="v">passive</td></tr>
      </table>
      <div class="qcard-next">-> <strong>4А.2</strong></div>
    </div>

    <!-- Q 4A.2 -->
    <div class="qcard qcard-pink" id="q4a2" style="left:100px; top:3740px;">
      <div class="qcard-head">
        <span class="qcard-num">4А.2</span>
        <span class="qcard-title">Что ему нравится?</span>
        <span class="qcard-var">{he_likes}</span>
      </div>
      <div class="qcard-msg">Как думаешь, что ему больше нравится?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Страсть и огонь</td><td class="v">passion</td></tr>
        <tr><td><span class="b">2</span> Нежность и прелюдии</td><td class="v">tenderness</td></tr>
        <tr><td><span class="b">3</span> Эксперименты и новизна</td><td class="v">novelty</td></tr>
        <tr><td><span class="b">4</span> Минет</td><td class="v">oral</td></tr>
        <tr><td><span class="b">5</span> Всего по чуть-чуть</td><td class="v">everything</td></tr>
      </table>
      <div class="qcard-next">-> <strong>4А.3</strong></div>
    </div>

    <!-- Q 4A.3 -->
    <div class="qcard qcard-pink" id="q4a3" style="left:100px; top:4080px;">
      <div class="qcard-head">
        <span class="qcard-num">4А.3</span>
        <span class="qcard-title">Его реакция на инициативу?</span>
        <span class="qcard-var">{he_response}</span>
      </div>
      <div class="qcard-msg">Когда ты проявляешь инициативу, он...</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> В восторге, удвоенная страсть</td><td class="v">enthusiastic</td></tr>
        <tr><td><span class="b">2</span> Рад, но не отзеркаливает</td><td class="v">accepts</td></tr>
        <tr><td><span class="b">3</span> Не отвечает взаимностью</td><td class="v">cold</td></tr>
        <tr><td><span class="b">4</span> Я редко проявляю</td><td class="v">rare</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Блок 5</strong></div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 4B: ABOUT IDEAL (3 questions) ============= -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:1400px; top:3380px; color:var(--blue);">Блок 4Б: Про Идеал (status = free)</div>

    <!-- Q 4Б.1 -->
    <div class="qcard qcard-blue" id="q4b1" style="left:1400px; top:3440px;">
      <div class="qcard-head">
        <span class="qcard-num">4Б.1</span>
        <span class="qcard-title">Какой типаж зажигает?</span>
        <span class="qcard-var">{ideal_type}</span>
      </div>
      <div class="qcard-msg">Твой идеальный мужчина — какой типаж зажигает?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Альфа — уверенный, доминантный</td><td class="v">alpha</td></tr>
        <tr><td><span class="b">2</span> Романтик — нежный, внимательный</td><td class="v">romantic</td></tr>
        <tr><td><span class="b">3</span> Интеллектуал — умный</td><td class="v">intellectual</td></tr>
        <tr><td><span class="b">4</span> Весельчак — лёгкий, с юмором</td><td class="v">fun</td></tr>
      </table>
      <div class="qcard-next">-> <strong>4Б.2</strong></div>
    </div>

    <!-- Q 4Б.2 -->
    <div class="qcard qcard-blue" id="q4b2" style="left:1400px; top:3740px;">
      <div class="qcard-head">
        <span class="qcard-num">4Б.2</span>
        <span class="qcard-title">Что должен транслировать?</span>
        <span class="qcard-var">{ideal_vibe}</span>
      </div>
      <div class="qcard-msg">Что он должен транслировать, чтобы тебя зацепить?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Силу и надёжность</td><td class="v">strength</td></tr>
        <tr><td><span class="b">2</span> Заботу и внимание</td><td class="v">care</td></tr>
        <tr><td><span class="b">3</span> Открытое желание и страсть</td><td class="v">desire</td></tr>
        <tr><td><span class="b">4</span> Уважение и партнёрство</td><td class="v">respect</td></tr>
      </table>
      <div class="qcard-next">-> <strong>4Б.3</strong></div>
    </div>

    <!-- Q 4Б.3 -->
    <div class="qcard qcard-blue" id="q4b3" style="left:1400px; top:4080px;">
      <div class="qcard-head">
        <span class="qcard-num">4Б.3</span>
        <span class="qcard-title">В близости важнее всего?</span>
        <span class="qcard-var">{ideal_intimacy}</span>
      </div>
      <div class="qcard-msg">В близости для тебя важнее всего...</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Химия — чтобы искрило</td><td class="v">chemistry</td></tr>
        <tr><td><span class="b">2</span> Эмоциональная связь</td><td class="v">emotional</td></tr>
        <tr><td><span class="b">3</span> Чтобы чувствовал моё тело</td><td class="v">sensual</td></tr>
        <tr><td><span class="b">4</span> Открытость экспериментам</td><td class="v">open</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Результат</strong> (блок 5 пропускается)</div>
    </div>


    <!-- ============================================================ -->
    <!-- ========== BLOCK 5: ABOUT RELATIONSHIP (5 questions) ======= -->
    <!-- ============================================================ -->
    <div class="group-label" style="left:100px; top:4440px; color:var(--pink);">Блок 5: Про Отношения (только status != free)</div>

    <!-- Q 5.1 -->
    <div class="qcard qcard-pink" id="q51" style="left:100px; top:4520px;">
      <div class="qcard-head">
        <span class="qcard-num">5.1</span>
        <span class="qcard-title">Как часто близость?</span>
        <span class="qcard-var">{frequency}</span>
      </div>
      <div class="qcard-msg">Как часто у вас близость?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th><th class="p">Б</th></tr>
        <tr><td><span class="b">1</span> Каждый день или почти</td><td class="v">daily</td><td class="p">5</td></tr>
        <tr><td><span class="b">2</span> 2-3 раза в неделю</td><td class="v">often</td><td class="p">4</td></tr>
        <tr><td><span class="b">3</span> Раз в неделю</td><td class="v">weekly</td><td class="p">3</td></tr>
        <tr><td><span class="b">4</span> Пару раз в месяц</td><td class="v">monthly</td><td class="p">2</td></tr>
        <tr><td><span class="b">5</span> Реже</td><td class="v">rare</td><td class="p">1</td></tr>
      </table>
      <div class="qcard-next">-> <strong>5.2</strong></div>
    </div>

    <!-- Q 5.2 -->
    <div class="qcard qcard-pink" id="q52" style="left:500px; top:4520px;">
      <div class="qcard-head">
        <span class="qcard-num">5.2</span>
        <span class="qcard-title">Кто инициирует?</span>
        <span class="qcard-var">{initiator}</span>
      </div>
      <div class="qcard-msg">Кто обычно инициирует?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Чаще он</td><td class="v">he</td></tr>
        <tr><td><span class="b">2</span> Чаще я</td><td class="v">she</td></tr>
        <tr><td><span class="b">3</span> Примерно поровну</td><td class="v">balanced</td></tr>
        <tr><td><span class="b">4</span> Никто особо</td><td class="v">nobody</td></tr>
      </table>
      <div class="qcard-next">-> <strong>5.3</strong></div>
    </div>

    <!-- Q 5.3 -->
    <div class="qcard qcard-pink" id="q53" style="left:100px; top:4870px;">
      <div class="qcard-head">
        <span class="qcard-num">5.3</span>
        <span class="qcard-title">Измены / подозрения?</span>
        <span class="qcard-var">{cheating}</span>
      </div>
      <div class="qcard-msg">Были ли измены или подозрения?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Нет, доверяю полностью</td><td class="v">trust</td></tr>
        <tr><td><span class="b">2</span> Иногда сомневаюсь</td><td class="v">doubts</td></tr>
        <tr><td><span class="b">3</span> Подозреваю, странности</td><td class="v">suspect</td></tr>
        <tr><td><span class="b">4</span> Да, была измена</td><td class="v">yes</td></tr>
        <tr><td><span class="b">5</span> Не хочу отвечать</td><td class="v">skip</td></tr>
      </table>
      <div class="qcard-next">-> <strong>5.4</strong></div>
    </div>

    <!-- Q 5.4 -->
    <div class="qcard qcard-pink" id="q54" style="left:500px; top:4870px;">
      <div class="qcard-head">
        <span class="qcard-num">5.4</span>
        <span class="qcard-title">Что беспокоит сейчас?</span>
        <span class="qcard-var">{main_problem}</span>
      </div>
      <div class="qcard-msg">Что больше всего беспокоит в отношениях?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Измена / подозрения</td><td class="v">cheating_worry</td></tr>
        <tr><td><span class="b">2</span> Живём как соседи</td><td class="v">roommates</td></tr>
        <tr><td><span class="b">3</span> Пропала романтика</td><td class="v">no_romance</td></tr>
        <tr><td><span class="b">4</span> Нет удовольствия в сексе</td><td class="v">no_pleasure</td></tr>
        <tr><td><span class="b">5</span> Много обид</td><td class="v">resentment</td></tr>
        <tr><td><span class="b">6</span> Всё хорошо</td><td class="v">ok</td></tr>
      </table>
      <div class="qcard-next">-> <strong>5.5</strong></div>
    </div>

    <!-- Q 5.5 -->
    <div class="qcard qcard-pink" id="q55" style="left:300px; top:5260px;">
      <div class="qcard-head">
        <span class="qcard-num">5.5</span>
        <span class="qcard-title">Изменить одно в интимной жизни?</span>
        <span class="qcard-var">{change_wish}</span>
      </div>
      <div class="qcard-msg">Если бы можно было изменить одно в интимной жизни?</div>
      <table class="qcard-table">
        <tr><th>Кнопка</th><th>Значение</th></tr>
        <tr><td><span class="b">1</span> Хочу чаще</td><td class="v">more_frequency</td></tr>
        <tr><td><span class="b">2</span> Хочу разнообразнее</td><td class="v">more_variety</td></tr>
        <tr><td><span class="b">3</span> Хочу больше страсти</td><td class="v">more_passion</td></tr>
        <tr><td><span class="b">4</span> Больше своего удовольствия</td><td class="v">more_pleasure</td></tr>
        <tr><td><span class="b">5</span> Всё устраивает</td><td class="v">satisfied</td></tr>
      </table>
      <div class="qcard-next">-> <strong>Результат</strong></div>
    </div>


    <!-- ========== RESULTS ========== -->
    <div class="group-label" style="left:100px; top:5560px; color:var(--green);">Результаты</div>

    <div class="placeholder-card qcard-green" style="left:100px; top:5640px; width:500px;">
      Этап 6 — Рекомендации В ПАРЕ: П1-П15<br>
      15 комбинаций с приоритетом &middot; П15 = fallback
    </div>

    <div class="placeholder-card qcard-green" style="left:1400px; top:5640px; width:500px;">
      Этап 6 — Рекомендации СВОБОДНЫЕ: С1-С15<br>
      15 комбинаций с приоритетом &middot; С15 = fallback
    </div>

    <!-- Variables -->
    <div class="placeholder-card" style="left:700px; top:5890px; width:700px; border-color: var(--green);">
      Этап 7 — Сводная таблица всех переменных
    </div>

  </div>
</div>

<!-- LEGEND -->
<div class="legend">
  <div class="legend-row"><div class="legend-dot" style="background:var(--purple)"></div>Блок 1 — общие</div>
  <div class="legend-row"><div class="legend-dot" style="background:var(--pink)"></div>Ветка «В паре»</div>
  <div class="legend-row"><div class="legend-dot" style="background:var(--blue)"></div>Ветка «Свободна»</div>
  <div class="legend-row"><div class="legend-dot" style="background:var(--orange)"></div>Блок 3 — для всех</div>
  <div class="legend-row"><div class="legend-dot" style="background:var(--green)"></div>Результат</div>
</div>

<!-- MINIMAP -->
<div class="minimap" id="minimap">
  <canvas id="mmCanvas" width="180" height="120"></canvas>
  <div class="minimap-vp" id="mmVp"></div>
</div>

<script>
// === PAN & ZOOM ===
const wrap = document.getElementById('wrap');
const cvs = document.getElementById('canvas');
let sc = 0.45, px = 0, py = 0;
let panning = false, sx, sy;
let cardDrag = null; // { el, offsetX, offsetY }

function apply() {
  cvs.style.transform = `translate(${px}px,${py}px) scale(${sc})`;
  document.getElementById('zoomLvl').textContent = Math.round(sc*100)+'%';
  updateMM();
}

// --- Pan on background ---
wrap.addEventListener('mousedown', e => {
  const card = e.target.closest('.qcard, .decision, .placeholder-card');
  if (card) {
    // START CARD DRAG
    e.stopPropagation();
    e.preventDefault();
    const wr = wrap.getBoundingClientRect();
    const bx = (e.clientX - wr.left - px) / sc;
    const by = (e.clientY - wr.top - py) / sc;
    cardDrag = {
      el: card,
      offsetX: bx - parseInt(card.style.left),
      offsetY: by - parseInt(card.style.top)
    };
    card.classList.add('dragging');
    // Show coord tooltip
    let tip = document.getElementById('dragTip');
    if (!tip) { tip = document.createElement('div'); tip.id = 'dragTip'; document.body.appendChild(tip); }
    tip.style.cssText = 'position:fixed;padding:4px 10px;background:rgba(0,0,0,0.85);color:#fff;font:12px monospace;border-radius:6px;pointer-events:none;z-index:9999;';
    tip.textContent = `left:${parseInt(card.style.left)} top:${parseInt(card.style.top)}`;
    tip.style.left = e.clientX + 14 + 'px';
    tip.style.top = e.clientY + 14 + 'px';
    tip.style.display = 'block';
  } else {
    // START PAN
    panning = true; sx = e.clientX - px; sy = e.clientY - py;
    wrap.classList.add('panning'); e.preventDefault();
  }
});

window.addEventListener('mousemove', e => {
  if (cardDrag) {
    const wr = wrap.getBoundingClientRect();
    const bx = (e.clientX - wr.left - px) / sc;
    const by = (e.clientY - wr.top - py) / sc;
    const nl = Math.round(bx - cardDrag.offsetX);
    const nt = Math.round(by - cardDrag.offsetY);
    cardDrag.el.style.left = nl + 'px';
    cardDrag.el.style.top = nt + 'px';
    drawArrows();
    updateMM();
    const tip = document.getElementById('dragTip');
    if (tip) {
      tip.textContent = `left:${nl}  top:${nt}`;
      tip.style.left = e.clientX + 14 + 'px';
      tip.style.top = e.clientY + 14 + 'px';
    }
    return;
  }
  if (!panning) return;
  px = e.clientX - sx; py = e.clientY - sy; apply();
});

window.addEventListener('mouseup', () => {
  if (cardDrag) {
    cardDrag.el.classList.remove('dragging');
    const tip = document.getElementById('dragTip');
    if (tip) tip.style.display = 'none';
    saveLayout();
    cardDrag = null;
  }
  panning = false; wrap.classList.remove('panning');
});

wrap.addEventListener('wheel', e => {
  e.preventDefault();
  const d = e.deltaY > 0 ? -0.05 : 0.05;
  const ns = Math.min(2, Math.max(0.15, sc + d));
  const r = wrap.getBoundingClientRect();
  const cx = e.clientX - r.left, cy = e.clientY - r.top;
  px = cx - (cx - px) * (ns / sc);
  py = cy - (cy - py) * (ns / sc);
  sc = ns;
  apply();
}, { passive: false });

function zoomBy(d) { sc = Math.min(2, Math.max(0.15, sc + d)); apply(); }
function resetView() { sc = 0.45; px = 0; py = 0; apply(); }
function jumpTo(x, y) {
  const r = wrap.getBoundingClientRect();
  px = r.width/2 - x * sc;
  py = r.height/2 - y * sc;
  apply();
}

// === DRAW ARROWS ===
// Smart bezier: vertical for tall arrows, horizontal for wide arrows
function line(x1, y1, x2, y2, color, marker) {
  const svg = document.getElementById('svg');
  const p = document.createElementNS('http://www.w3.org/2000/svg','path');
  const dx = Math.abs(x2-x1), dy = Math.abs(y2-y1);
  let d;
  if (dy > dx) {
    const my = (y1 + y2) / 2;
    d = `M${x1},${y1} C${x1},${my} ${x2},${my} ${x2},${y2}`;
  } else {
    const mx = (x1 + x2) / 2;
    d = `M${x1},${y1} C${mx},${y1} ${mx},${y2} ${x2},${y2}`;
  }
  p.setAttribute('d', d);
  p.setAttribute('stroke', color);
  p.setAttribute('stroke-width', '2');
  p.setAttribute('fill', 'none');
  p.setAttribute('stroke-opacity', '0.5');
  p.setAttribute('marker-end', `url(#${marker})`);
  svg.appendChild(p);
}

// Horizontal-then-vertical stepped path
function stepLine(x1, y1, x2, y2, color, marker) {
  const svg = document.getElementById('svg');
  const p = document.createElementNS('http://www.w3.org/2000/svg','path');
  const my = (y1 + y2) / 2;
  p.setAttribute('d', `M${x1},${y1} L${x1},${my} L${x2},${my} L${x2},${y2}`);
  p.setAttribute('stroke', color);
  p.setAttribute('stroke-width', '2');
  p.setAttribute('fill', 'none');
  p.setAttribute('stroke-opacity', '0.4');
  p.setAttribute('marker-end', `url(#${marker})`);
  svg.appendChild(p);
}

function getBot(id) { const e=document.getElementById(id); if(!e)return null; return { x:parseInt(e.style.left)+e.offsetWidth/2, y:parseInt(e.style.top)+e.offsetHeight }; }
function getTop(id) { const e=document.getElementById(id); if(!e)return null; return { x:parseInt(e.style.left)+e.offsetWidth/2, y:parseInt(e.style.top) }; }
function getRight(id) { const e=document.getElementById(id); if(!e)return null; return { x:parseInt(e.style.left)+e.offsetWidth, y:parseInt(e.style.top)+e.offsetHeight/2 }; }
function getLeft(id) { const e=document.getElementById(id); if(!e)return null; return { x:parseInt(e.style.left), y:parseInt(e.style.top)+e.offsetHeight/2 }; }

function drawArrows() {
  const svg = document.getElementById('svg');
  svg.querySelectorAll('path').forEach(p=>p.remove());

  // ===== BLOCK 1 =====
  // 1.1 -> 1.1б (left fork)
  const q11b = getBot('q11'), q11bT = getTop('q11b'), q12T = getTop('q12');
  if(q11b && q11bT) line(q11b.x - 60, q11b.y, q11bT.x, q11bT.y, '#6b9dff','ab');
  // 1.1 -> 1.2 (right fork)
  if(q11b && q12T) line(q11b.x + 60, q11b.y, q12T.x, q12T.y, '#ff6b9d','ak');

  // 1.1б -> 1.3
  const q11bb = getBot('q11b'), q13T = getTop('q13');
  if(q11bb && q13T) line(q11bb.x, q11bb.y, q13T.x - 60, q13T.y, '#a06bff','ap');
  // 1.2 -> 1.3
  const q12b = getBot('q12');
  if(q12b && q13T) line(q12b.x, q12b.y, q13T.x + 60, q13T.y, '#a06bff','ap');

  // 1.3 -> Decision 1
  const q13b = getBot('q13'), d1t = getTop('dec1');
  if(q13b && d1t) line(q13b.x, q13b.y, d1t.x, d1t.y, '#a06bff','ap');

  // Decision 1 -> 2A.1, 2B.1
  const d1b = getBot('dec1'), q2a1t = getTop('q2a1'), q2b1t = getTop('q2b1');
  if(d1b && q2a1t) line(d1b.x - 80, d1b.y, q2a1t.x, q2a1t.y, '#ff6b9d','ak');
  if(d1b && q2b1t) line(d1b.x + 80, d1b.y, q2b1t.x, q2b1t.y, '#6b9dff','ab');

  // ===== BLOCK 2A chain =====
  [['q2a1','q2a2'],['q2a2','q2a3']].forEach(([a,b]) => {
    const f=getBot(a), t=getTop(b);
    if(f&&t) line(f.x, f.y, t.x, t.y, '#ff6b9d','ak');
  });

  // ===== BLOCK 2B chains =====
  // Left column: 2B.1 -> 2B.2 -> 2B.3
  [['q2b1','q2b2'],['q2b2','q2b3']].forEach(([a,b]) => {
    const f=getBot(a), t=getTop(b);
    if(f&&t) line(f.x, f.y, t.x, t.y, '#6b9dff','ab');
  });
  // Right column: 2B.4 -> 2B.5 -> 2B.6
  [['q2b4','q2b5'],['q2b5','q2b6']].forEach(([a,b]) => {
    const f=getBot(a), t=getTop(b);
    if(f&&t) line(f.x, f.y, t.x, t.y, '#6b9dff','ab');
  });
  // Cross: 2B.3 -> 2B.4 (step path right->up)
  const b3r = getRight('q2b3'), b4l = getLeft('q2b4');
  if(b3r && b4l) stepLine(b3r.x, b3r.y, b4l.x, b4l.y, '#6b9dff','ab');

  // ===== 2A.3 -> Block 3 (first card), 2B.6 -> Block 3 =====
  const q2a3b = getBot('q2a3'), q31t = getTop('q31');
  if(q2a3b && q31t) line(q2a3b.x, q2a3b.y, q31t.x, q31t.y, '#ff6b9d','ak');

  const q2b6b = getBot('q2b6');
  if(q2b6b && q31t) line(q2b6b.x, q2b6b.y, q31t.x + 80, q31t.y, '#6b9dff','ab');

  // ===== BLOCK 3 GRID: Row 1 horizontal (3.1->3.2->3.3->3.4->3.5) =====
  [['q31','q32'],['q32','q33'],['q33','q34'],['q34','q35']].forEach(([a,b]) => {
    const f=getRight(a), t=getLeft(b);
    if(f&&t) line(f.x, f.y, t.x, t.y, '#ffaa6b','ao');
  });

  // Row 1 -> Row 2 wrap: 3.5 -> 3.6 (down-left diagonal)
  const q35b = getBot('q35'), q36t = getTop('q36');
  if(q35b && q36t) line(q35b.x, q35b.y, q36t.x, q36t.y, '#ffaa6b','ao');

  // Row 2 horizontal (3.6->3.7->3.8->3.9)
  [['q36','q37'],['q37','q38'],['q38','q39']].forEach(([a,b]) => {
    const f=getRight(a), t=getLeft(b);
    if(f&&t) line(f.x, f.y, t.x, t.y, '#ffaa6b','ao');
  });

  // ===== Block 3 last card -> scoring =====
  const q39b = getBot('q39'), sct = getTop('scoring');
  if(q39b && sct) line(q39b.x, q39b.y, sct.x, sct.y, '#ffaa6b','ao');

  // scoring -> decision2
  const scb = getBot('scoring'), d2t = getTop('dec2');
  if(scb && d2t) line(scb.x, scb.y, d2t.x, d2t.y, '#ffaa6b','ao');

  // ===== decision2 -> 4A, 4B =====
  const d2b = getBot('dec2'), q4a1t = getTop('q4a1'), q4b1t = getTop('q4b1');
  if(d2b && q4a1t) line(d2b.x - 80, d2b.y, q4a1t.x, q4a1t.y, '#ff6b9d','ak');
  if(d2b && q4b1t) line(d2b.x + 80, d2b.y, q4b1t.x, q4b1t.y, '#6b9dff','ab');

  // ===== 4A chain: 4A.1->4A.2->4A.3 =====
  [['q4a1','q4a2'],['q4a2','q4a3']].forEach(([a,b])=>{
    const f=getBot(a),t=getTop(b);
    if(f&&t) line(f.x,f.y,t.x,t.y,'#ff6b9d','ak');
  });

  // ===== 4B chain: 4B.1->4B.2->4B.3 =====
  [['q4b1','q4b2'],['q4b2','q4b3']].forEach(([a,b])=>{
    const f=getBot(a),t=getTop(b);
    if(f&&t) line(f.x,f.y,t.x,t.y,'#6b9dff','ab');
  });

  // ===== 4A.3 -> Block 5.1 =====
  const q4a3b=getBot('q4a3'), q51t=getTop('q51');
  if(q4a3b&&q51t) line(q4a3b.x,q4a3b.y,q51t.x,q51t.y,'#ff6b9d','ak');

  // ===== BLOCK 5 CHAIN: 5.1->5.2 (right), 5.2->5.3 (down-left), 5.3->5.4 (right), 5.4->5.5 (down) =====
  // 5.1 -> 5.2 horizontal
  const q51r=getRight('q51'), q52l=getLeft('q52');
  if(q51r&&q52l) line(q51r.x,q51r.y,q52l.x,q52l.y,'#ff6b9d','ak');

  // 5.2 -> 5.3 wrap to next row
  const q52b=getBot('q52'), q53t=getTop('q53');
  if(q52b&&q53t) line(q52b.x,q52b.y,q53t.x,q53t.y,'#ff6b9d','ak');

  // 5.3 -> 5.4 horizontal
  const q53r=getRight('q53'), q54l=getLeft('q54');
  if(q53r&&q54l) line(q53r.x,q53r.y,q54l.x,q54l.y,'#ff6b9d','ak');

  // 5.4 -> 5.5 down
  const q54b=getBot('q54'), q55t=getTop('q55');
  if(q54b&&q55t) line(q54b.x,q54b.y,q55t.x,q55t.y,'#ff6b9d','ak');
}

// === MINIMAP ===
function updateMM() {
  const mc=document.getElementById('mmCanvas'), ctx=mc.getContext('2d');
  ctx.clearRect(0,0,mc.width,mc.height);
  const bw=2200, bh=6200, s=Math.min(mc.width/bw, mc.height/bh);
  document.querySelectorAll('.qcard,.placeholder-card,.decision').forEach(n=>{
    const x=parseInt(n.style.left)*s, y=parseInt(n.style.top)*s;
    const w=(n.offsetWidth||340)*s, h=(n.offsetHeight||100)*s;
    if(n.classList.contains('qcard-purple')||n.classList.contains('decision')) ctx.fillStyle='#a06bff';
    else if(n.classList.contains('qcard-pink')) ctx.fillStyle='#ff6b9d';
    else if(n.classList.contains('qcard-blue')) ctx.fillStyle='#6b9dff';
    else if(n.classList.contains('qcard-orange')) ctx.fillStyle='#ffaa6b';
    else if(n.classList.contains('qcard-green')) ctx.fillStyle='#6bffb8';
    else ctx.fillStyle='#555';
    ctx.globalAlpha=0.7;
    ctx.fillRect(x,y,Math.max(w,3),Math.max(h,2));
  });
  ctx.globalAlpha=1;
  const vp=document.getElementById('mmVp'), wr=wrap.getBoundingClientRect();
  vp.style.left=(-px/sc)*s+'px'; vp.style.top=(-py/sc)*s+'px';
  vp.style.width=(wr.width/sc)*s+'px'; vp.style.height=(wr.height/sc)*s+'px';
}

// === SAVE / LOAD LAYOUT (localStorage) ===
function saveLayout() {
  const positions = {};
  document.querySelectorAll('.qcard[id], .decision[id], .placeholder-card[id]').forEach(el => {
    positions[el.id] = { left: parseInt(el.style.left), top: parseInt(el.style.top) };
  });
  localStorage.setItem('quiz_layout', JSON.stringify(positions));
}
function loadLayout() {
  const raw = localStorage.getItem('quiz_layout');
  if (!raw) return;
  try {
    const positions = JSON.parse(raw);
    Object.entries(positions).forEach(([id, pos]) => {
      const el = document.getElementById(id);
      if (el) { el.style.left = pos.left + 'px'; el.style.top = pos.top + 'px'; }
    });
  } catch(e) {}
}
function resetLayout() {
  localStorage.removeItem('quiz_layout');
  location.reload();
}
function exportLayout() {
  const positions = {};
  document.querySelectorAll('.qcard[id], .decision[id], .placeholder-card[id]').forEach(el => {
    positions[el.id] = { left: parseInt(el.style.left), top: parseInt(el.style.top) };
  });
  const blob = new Blob([JSON.stringify(positions, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'quiz-layout.json'; a.click();
}

// === INIT ===
loadLayout();
apply();
requestAnimationFrame(()=>requestAnimationFrame(drawArrows));
</script>

</body>
</html>
